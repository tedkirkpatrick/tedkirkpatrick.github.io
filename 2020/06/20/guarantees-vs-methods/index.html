<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="description" content="Blog for A. E. Kirkpatrick and  Kirkpatrick Computing Services">
  <meta name="author" content="Arthur E. Kirkpatrick">
  <meta name="copyright" content="Arthur E. Kirkpatrick, 2018, 2019, 2020, 2021">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Guarantees vs. metrics: What the designers intend, what the clients see &middot; All my marbles in one place
    
  </title>

    <!-- Asychronously-loaded JavaScript -->
    

  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66576928-4', 'auto');
  ga('send', 'pageview');
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Guarantees vs. metrics: What the designers intend, what the clients see" />
<meta name="author" content="Ted Kirkpatrick" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In my distributed systems design space, I distinguish guarantees from metrics. A guarantee is a property a system is designed to ensure in all cases, such as consistency between replicas of a data store, or the number of copies written to persistent storage before a result is returned to the client. In contrast, a metric is a measurable quantity of a system, such as median latency or annual availability. The guarantee/metric distinction arises from the designer’s perspective and clearly separates the two categories. But when we consider the categories instead from the perspective of the system’s clients, this distinction becomes fuzzier. Is it real? Is it valuable?" />
<meta property="og:description" content="In my distributed systems design space, I distinguish guarantees from metrics. A guarantee is a property a system is designed to ensure in all cases, such as consistency between replicas of a data store, or the number of copies written to persistent storage before a result is returned to the client. In contrast, a metric is a measurable quantity of a system, such as median latency or annual availability. The guarantee/metric distinction arises from the designer’s perspective and clearly separates the two categories. But when we consider the categories instead from the perspective of the system’s clients, this distinction becomes fuzzier. Is it real? Is it valuable?" />
<meta property="og:site_name" content="All my marbles in one place" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-20T00:00:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Guarantees vs. metrics: What the designers intend, what the clients see" />
<script type="application/ld+json">
{"description":"In my distributed systems design space, I distinguish guarantees from metrics. A guarantee is a property a system is designed to ensure in all cases, such as consistency between replicas of a data store, or the number of copies written to persistent storage before a result is returned to the client. In contrast, a metric is a measurable quantity of a system, such as median latency or annual availability. The guarantee/metric distinction arises from the designer’s perspective and clearly separates the two categories. But when we consider the categories instead from the perspective of the system’s clients, this distinction becomes fuzzier. Is it real? Is it valuable?","url":"/2020/06/20/guarantees-vs-methods/","headline":"Guarantees vs. metrics: What the designers intend, what the clients see","dateModified":"2020-06-20T00:00:00-07:00","datePublished":"2020-06-20T00:00:00-07:00","author":{"@type":"Person","name":"Ted Kirkpatrick"},"mainEntityOfPage":{"@type":"WebPage","@id":"/2020/06/20/guarantees-vs-methods/"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body class="theme-base-0c layout-reverse">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          All my marbles in one place
        </a>
      </h1>
      <p class="lead">A blog about course design, data display, C++, and Python.  Yes, these are related, at least as I see them.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/comment-policy/">Comment policy</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/credits/">Credits</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

    
        <div class="sidebar-tags">
        Tags:<br/>
        
	   
	    <a href="/tag/C++/">C++</a>,
	  
        
	   
	    <a href="/tag/Python/">Python</a>,
	  
        
	   
	    <a href="/tag/Course design/">Course design</a>,
	  
        
	   
	    <a href="/tag/Big data/">Big data</a>,
	  
        
	   
	    <a href="/tag/Soft skills/">Soft skills</a>,
	  
        
	   
	    <a href="/tag/Statistics/">Statistics</a>,
	  
        
	   
	    <a href="/tag/Experimental design/">Experimental design</a>,
	  
        
	   
	    <a href="/tag/Rhetoric/">Rhetoric</a>,
	  
        
	   
	    <a href="/tag/Admin/">Admin</a>,
	  
        
	  	    
            <a href="/tag/Distributed systems/">Distributed systems</a>
          
        
	</div>
      

    </nav>

    <p>&copy; 2021. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Guarantees vs. metrics: What the designers intend, what the clients see</h1>
  <span class="post-date">20 Jun 2020
  
    <span class="tag-block">Tags: 
    
      
      <a href="/tag/Distributed systems">Distributed systems</a>
      
    
    </span>
  
  </span>
  
  <p>In my
<a href="/2019/12/31/design-space-2020/">distributed systems design space</a>, I
distinguish guarantees from metrics. A <em>guarantee</em> is a property a
system is designed to ensure in all cases, such as consistency between
replicas of a data store, or the number of copies written to
persistent storage before a result is returned to the client. In
contrast, a <em>metric</em> is a measurable quantity of a system, such as
median latency or annual availability. The guarantee/metric
distinction arises from the designer’s perspective and clearly
separates the two categories. But when we consider the categories
instead from the perspective of the system’s clients, this distinction
becomes fuzzier. Is it real? Is it valuable?</p>

<h2 id="guarantees-express-a-designers-intent-via-software">Guarantees express a designer’s intent via software</h2>

<p>When a designer includes a guarantee in a system specification, they
are committing substantial resources. Guarantees such as consistency
or multi-copy durability increase algorithm and code complexity, may
increase latency and reduce throughput, and generally increase the
system’s lifetime cost. The designer imposes that cost because they
believe the guarantee is essential to meet user’s expectations for the
service. The designer chooses consistency across storage replicas when
they believe that client applications need the closest possible
behaviour to a single replica and they choose multi-copy durability
when they believe users have strong expectations that their data will
be protected against failures of storage media.</p>

<p>A guarantee is a serious commitment for the system implementors, both
those building the first version and those maintaining later versions.
Any violation of the guarantee by the system is considered a defect
and a fix is scheduled, often with a high priority.</p>

<p>Marketing for the system, whether for internal or external
clients, will often include the guarantee. Clients will use
the system with the expectation that the guarantee is met every
time. System documentation might even express the guarantee in
<a href="https://en.wikipedia.org/wiki/Hoare_logic">Hoare triples</a>: If an API
call meets these preconditions, the following postconditions are
guaranteed to hold upon return.</p>

<p>Ultimately, a guarantee is an expression of strong intent by the
designer, ensured by strenuous implementation efforts and relied upon
by the system’s clients.</p>

<h2 id="clients-only-observe-metrics">Clients only observe metrics</h2>

<p>A funny thing happens to the designer’s intent on the way to the
client: It becomes a metric. The client can only determine the
designer’s actual success by measuring the number of times the
guarantee is violated in a given time period. However strongly the
designer may have stated their intention, however strenuously the
implementors tested the system, to the client’s eyes the guarantee is
another metric, an observed rate of deviation from perfect
implementation.</p>

<p>Our system guarantees are never realized 100% due to several
factors:</p>

<ul>
  <li>Systems have bugs. No matter how many quality assurance
techniques we add to our development process, our systems will incorrectly
handle some obscure or unexpected
combinations of circumstance.</li>
  <li>The imperfect world may not correspond to our perfect
software. For example, items can be lost in shipment or data may be
incorrectly entered.  From the client’s perspective, there is no
sharp line between “the world” and “the software”.  The client
only sees unmet expectations.</li>
</ul>

<p>If clients only see metrics, is there any value to distinguishing
guarantees from metrics? Even though the distinction isn’t sharp,
I believe it remains valuable for several purposes.</p>

<h2 id="distinguishing-endogenous-from-exogenous-threats">Distinguishing endogenous from exogenous threats</h2>

<p>Specifying a guarantee makes the team responsible for preventing a
wider range of events. A specification defines which events are
endogenous and which are exogenous. An <em>exogenous</em> event is considered
outside the system, something that happens to the system. The team
cannot affect these events’ incidence but is responsible for the
system responding to them reliably. An <em>endogenous</em> event, on the
other hand, is considered under the system’s control, something that
the system does. The team has complete responsibility for endogenous
events.</p>

<p>These different responsibilities become most distinct in the case of
events that threaten the system’s reliability.  For exogenous threats,
no matter how obscure or infrequent, the team must ensure the system
remains in a defined state. This might well include treating the event
as a more regular one, ignoring it, logging it, or notifying the
operations staff. The team must harden the system against exogenous
threats. In contrast, endogenous threats are simply defects. Once one
is found, the team is responsible for ensuring it never recurs.</p>

<p>From the designer’s perspective, an event that lowers a metric is an
exogenous threat. For example, an application-level service probably
cannot do anything to prevent the failure of a network switch, so the
only recourse is to handle message loss and periods of
inaccessibility. Switch failures are exogenous to such systems,
outside the responsibility of the system designers.</p>

<p>By contrast, team members see an event that causes the system to
miss a guarantee as an endogenous threat. Entirely the team’s
responsibility, it must be fixed.</p>

<p>The team sees drops in a metric as an unfortunate fact of
life—networks are unreliable, what can ya do?—but violations of a
guarantee as shameful. The distinction between metrics and guarantees
imply very different ownership of threats.  The team works to
<em>mitigate the impact</em> of exogenous threats but works to <em>eliminate</em>
endogenous threats.  In both cases, their efforts will fall short but
it is endogenous threats whose incidence they must strive to bring as
near zero as possible.</p>

<h2 id="setting-client-expectations">Setting client expectations</h2>

<p>Defining and publishing a guarantee also sets client expectations. A
database that guarantees a high degree of consistency, such as
multiple persistent writes for durability, is claiming that client
data has a high degree of safety. This can be a powerful marketing
tool.</p>

<p>A published guarantee also calibrates expectations. Although a system
with five-way durability (five synchronously-written copies) may
occasionally lose data, the frequency of such loss will be extremely
low. For example, Amazon S3, which features five-way durability, has
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/DataDurability.html">an SLA of 99.999999999% durability</a>
(that’s <em>eleven</em> “9”s!). Clients can then define their data-protection
plans on the presumption of a very low risk of data loss.</p>

<h2 id="setting-developer-conceptual-models">Setting developer conceptual models</h2>

<p>In a related manner, publishing a guarantee provides a conceptual model
for developers building clients of the system. Developers find
programming to a strong consistency guarantee <a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/41344.pdf">far easier than
programming to a weak one</a>,
while strong durability guarantees permit developers to manage the
very low-probability risk of data loss.</p>

<p>Stronger models also justify and explain any performance costs
induced by the guarantee. If a developer knows that every write must
be persisted to five independent stores, the longer latency is
justified.</p>

<p>Expectations and conceptual models address the needs of different
communities within the client organization.  Marketing and financial
teams benefit from the expectations while development teams will use
the conceptual model.</p>

<h2 id="setting-organizational-values">Setting organizational values</h2>

<p>Where expectations and conceptual models are of use to communities outside
the development team, guarantees also contribute to the values and
culture of the team itself. A team building a
high-consistency database will pride themselves on the quality of
their technology. Rising to meet a difficult challenge inspires
developers and engenders <em>esprit de corps</em>.</p>

<p>Paradoxically, the absence of some guarantees can have the same
effect. For example,
<a href="https://cassandra.apache.org/">Cassandra’s home page</a> advertises that
“Highly available asynchronous operations are optimized with features
like Hinted Handoff and Read Repair”. Starting from an initial stance
of, “What would performance look like if we did not guarantee
consistency on all writes?”, the Cassandra community has pursued a
range of innovations, eventually even including versions of strong
consistency.</p>

<h2 id="the-value-of-distinguishing-guarantees-from-metrics">The value of distinguishing guarantees from metrics</h2>

<p>Although a guarantee only differs from a metric in terms of the degree
rather than the kind of externally visible outcome, the distinction
is nonetheless important. Stating a guarantee defines what threats are
endogenous, sets expectations within and outside the development team,
and forms a key element of the system’s conceptual model. The guarantee/metric
distinction, despite some fuzziness in its observable effects, is genuinely
important.</p>



</div>




<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = "http://kirkpatricktech.com/2020/06/20/guarantees-vs-methods/";
//this.page.identifier = "/2020/06/20/guarantees-vs-methods";
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://kirkpatricktech-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>

  </body>
</html>
